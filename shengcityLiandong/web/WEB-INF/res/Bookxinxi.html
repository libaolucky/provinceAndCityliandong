<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
          <link rel="stylesheet" type="text/css" href="/res/layui-v2.5.6/layui/css/layui.css">
         <script src="/res/layui-v2.5.6/layui/layui.js"></script>
          <script src="//cdn.bootcss.com/vue/2.5.2/vue.min.js"></script>

    <style>
        #tt{
            font-family: verdana,arial,sans-serif;
            font-size:11px;
            border-width: 2px;
            border-color: #8D8D8D;
            border-collapse: collapse;
            margin: 0 auto;
        }
        table td {
            border-width: 2px;
            padding: 8px;
            border-style: solid;
            border-color: #dddddd;
            background-color: #ffffff;
        }
    </style>
</head>
<body>
    <table id="tt">
        <p></p>
        <tr>
            <td colspan="2" align="left">
            <b>图书管理录入</b>
            </td>
        </tr>
        <tr>
            <td>图书名</td>
            <td>
                <input id="bookName" type="text" name="bookName">
            </td>
        </tr>
        <tr>
            <td>出版社所在地</td>
            <td>
                <select  id="province" name="province" onchange="OneAddress()">
                    <option value="">请选择</option>
                    <option value="湖北">湖北</option>
                    <option value="湖南">湖南</option>
                    <option value="广东">广东</option>
                </select>
                <select id="city" name="city">
                    <option value="">请选择</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>作者</td>
            <td>
             <input id="author" type="text" value="" name="author">
            </td>
        </tr>
        <tr>
            <td>零售价</td>
            <td>
                <input id="price" type="text" value="" name="price">
            </td>
        </tr>
        <tr>
            <td colspan="2" align="center">
                    <input id="addShop" type="submit" value="提交" style="text-align: center"/>
            </td>
        </tr>

    </table>


<script>
    // 一级 和 二级菜单的ajax
    function OneAddress() {
        $.ajax({
            url: '/api/address/selectAll',
            type: 'post',
            dataType: 'json',
            success: function (res) {
                console.log(res);
                // 省级选中的状态
                var province=$('#province option:selected').val();
                console.log(province);
                // 湖北省
                var hubei=res.addresss[0].addressname;
                // 湖南
                var hunan=res.addresss[1].addressname;
                //广东
                var guangdong=res.addresss[2].addressname;
                //$("#province").empty();
                // 省级的遍历
                // $.each(res.addresss, function (index, item) {
                //     if (item.parentid == 0) {
                //         var optionDom = $("<option value='"+item.addressname+"'>"+item.addressname + "</option>");
                //         $("#province").append(optionDom);//ajax异步下拉框
                //     }
                // });
                if(province == hubei){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 1) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                }
                if(province == hunan){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 2) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                }
                if(province == guangdong){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 3) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                };
            }
        });
    }


    $("#addShop").click(function () {
        // 创建 shop集合， 获取所有的数据
        var shop = {};
        shop.bookname = $('#bookName').val();
        shop.province = $("#province").find("option:selected").val();
        shop.city=$("#city").find("option:selected").val();
        shop.author = $('#author').val();
        shop.price = $('#price').val();

        $.ajax({
            url: '/api/shop/insert',
            type: 'post',
            data: JSON.stringify(shop),
            dataType: 'json',
            contentType:"application/json;charset=UTF-8",
            success: function (res) {
                console.log(res);
                if(res.code == 200){
                    alert(res.msg);
                }else{
                    alert("添加失败");
                }
                location.reload();
            }
        });
    });
</script>


</body>
</html>